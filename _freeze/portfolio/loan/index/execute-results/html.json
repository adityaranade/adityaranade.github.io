{
  "hash": "242b64e541585797afa37a81498dd8db",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Loan Schedule\"\nsubtitle: \"Let us understand the components of EMI\"\nauthor: \"Aditya Ranade\"\nhighlight-style:\n            light: github\ndate: \"2025-01-13\"\ncategories: [analysis, R]\nimage: \"./emi.jpg\"\noutput: html_document\nruntime: shiny\n---\n\n\n\n::: {style=\"text-align: justify\"}\nWe generally buy an asset on loan. In order to repay the loan, we have to pay Equated Monthly Payments (EMI). Every EMI payment contains a principal component and interest component. Let us look at the amortization of a loan.\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the packages\nlibrary(reshape2)\nlibrary(ggplot2)\nlibrary(ggh4x)\nlibrary(ggcorrplot)\nlibrary(car) # to calculate the VIF values\nlibrary(GGally) # for pairs plot using ggplot framework\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(shiny)\nlibrary(ggplot2)\nlibrary(DT)\n\nloan_schedule <- function(P, annual_rate, years, freq) {\n  \n  n <- years * freq                 # total number of payments\n  r <- annual_rate / 100 / freq     # interest rate per period\n  \n  if (r == 0) {\n    payment <- P / n\n  } else {\n    payment <- P * r * (1+r)^n / ((1+r)^n - 1)\n  }\n  \n  schedule <- data.frame(\n    Period = 1:n,\n    Opening_Balance = numeric(n),\n    Payment = rep(round(payment), n),\n    Interest = numeric(n),\n    Principal = numeric(n),\n    Interest_as_Percent_of_EMI = numeric(n),\n    Closing_Balance = numeric(n)\n  )\n  \n  balance <- P\n  \n  for (i in 1:n) {\n    interest <- balance * r\n    principal <- payment - interest\n    closing <- balance - principal\n    perc_emi <- (interest / payment ) *100\n    \n    \n    schedule$Opening_Balance[i] <- round(balance)\n    schedule$Interest[i] <- round(interest)\n    schedule$Principal[i] <- round(principal)\n    schedule$Interest_as_Percent_of_EMI[i] <- round(perc_emi,2)\n    schedule$Closing_Balance[i] <- round(closing)\n    \n    balance <- closing\n  }\n  \n  return(list(payment = round(payment), table = schedule))\n}\n\n\n# ---- UI ----\nui <- fluidPage(\n  \n  tags$head(\n    tags$style(HTML(\"\n    table, th, td {\n      text-align: center !important;\n      vertical-align: middle !important;\n    }\n  \"))\n  ),\n  \n  titlePanel(\"Loan Installments  & Amortization Schedule\"),\n  \n  sidebarLayout(\n    sidebarPanel(\n      numericInput(\"loan\", \"Loan Amount\", value = 1000000, min = 1000),\n      numericInput(\"rate\", \"Annual Interest Rate (%)\", value = 8, min = 0.1),\n      numericInput(\"years\", \"Tenure (Years)\", value = 10, min = 1),\n      selectInput(\"freq\", \"Payments per Year\",\n                  choices = c(\"Monthly\" = 12,\n                              \"Quarterly\" = 4,\n                              \"Semi-Annual\" = 2,\n                              \"Annual\" = 1),\n                  selected = 12)\n    ),\n    \n    mainPanel(\n      \n      fluidRow(\n        \n        # Panel 1 — EMI + Small summary\n        column(3,\n               h4(\"Installment Amount\"),\n               verbatimTextOutput(\"emi\")\n        ),\n        \n        # Panel 2 — Outstanding Balance Plot\n        column(4,\n               h4(\"Outstanding Balance\"),\n               plotOutput(\"balancePlot\", height = \"300px\")\n        ),\n        \n        # Panel 3 — Interest vs Principal Plot\n        column(5,\n               h4(\"Interest vs Principal\"),\n               plotOutput(\"ipPlot\", height = \"300px\")\n        )\n      ),\n      \n      br(),\n      \n      h4(\"Amortization Schedule\"),\n      # tableOutput(\"schedule\")\n      DT::DTOutput(\"schedule\")\n    )\n    \n    \n  )\n)\n\n# ---- Server ----\nserver <- function(input, output) {\n  \n  result <- reactive({\n    loan_schedule(input$loan, input$rate, input$years, as.numeric(input$freq))\n  })\n  \n  # Display payment per period\n  output$emi <- renderText({\n    paste(\"Payment per period =\", result()$payment)\n  })\n  \n  # Table\n  output$schedule <- DT::renderDT({\n    df <- result()$table  # this is a data frame\n    # Set nice display names\n    colnames(df) <- c(\n      \"Period\",\n      \"Opening Balance\",\n      \"Payment\",\n      \"Interest\",\n      \"Principal\",\n      \"Interest (% of Payment)\",\n      \"Closing Balance\"\n    )\n    \n    DT::datatable(\n      df,\n      options = list(\n        pageLength = 15,   # show 15 rows per page\n        lengthChange = FALSE,  # hide \"show 10/25/50\" dropdown\n        scrollX = TRUE,\n        ordering = TRUE,\n        searching = FALSE,          # ← disables the search box\n        columnDefs = list(list(className = 'dt-center', targets = \"_all\"))\n      ),\n      rownames = FALSE,\n      class = \"cell-border stripe\"  # adds lines/grid\n    )\n  })\n  \n  # Outstanding balance plot\n  output$balancePlot <- renderPlot({\n    df <- result()$table\n    \n    ggplot(df, aes(x = Period, y = Closing_Balance)) +\n      geom_line(linewidth = 1) +\n      labs(title = \"Outstanding Loan Balance Over Time\",\n           x = \"Payment Period\",\n           y = \"Balance\") +\n      scale_x_continuous(\n        breaks = seq(0, max(df$Period), by = as.numeric(input$freq))\n      ) +\n      theme_bw()\n  })\n  \n  # Interest vs Principal plot\n  output$ipPlot <- renderPlot({\n    df <- result()$table\n    \n    ggplot(df, aes(x = Period)) +\n      geom_line(aes(y = Interest, color = \"Interest\"), linewidth = 1) +\n      geom_line(aes(y = Principal, color = \"Principal\"), linewidth = 1) +\n      labs(title = \"Interest vs Principal Components\",\n           x = \"Payment Period\",\n           y = \"Amount\",\n           color = NULL) +\n      scale_color_manual(values = c(\"Interest\" = \"red\",\n                                    \"Principal\" = \"green\")) +\n      scale_x_continuous(\n        breaks = seq(0, max(df$Period), by = as.numeric(input$freq))\n      ) +\n      theme_bw() +\n      theme(legend.position = \"bottom\")\n  })\n}\n\n# ---- Run App ----\nshinyApp(ui = ui, server = server)\n```\n\n::: {.cell-output-display}\n`<iframe data-deferred-src=\"app326ce58c2411df59ff259799c8564abd/?w=&amp;__subapp__=1\" width=\"100%\" height=\"400\" class=\"shiny-frame shiny-frame-deferred\"></iframe>`{=html}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}